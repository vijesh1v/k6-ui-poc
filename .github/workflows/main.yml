# .github/workflows/k6-ui-browser.yml
name: k6 UI Browser Test

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  k6-ui-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # Install k6 with browser (Chromium) support
      - name: Setup k6 with browser support
        uses: grafana/setup-k6-action@v1
        with:
          browser: true          # installs Chrome for k6 browser tests
          # k6-version: '0.52.0' # optional, use a specific version

      # Run k6 test using official k6 runner
      - name: Run k6 UI browser test
        uses: grafana/run-k6-action@v1
        env:
          # Passed into the script as __ENV.BASE_URL (optional override)
          BASE_URL: https://example.com/
        with:
          # Path to your k6 test script(s)
          path: |
            ./k6/tests/ui-demo_test.js

          # Optional flags passed directly to `k6 run`
          flags: |
            --out json=./k6/results/ui-demo-results.json

      # Upload k6 results & screenshots as artifact
      - name: Upload k6 results artifact
        uses: actions/upload-artifact@v4
        with:
          name: k6-ui-results
          path: |
            ./k6/results/
            ./k6/tests/screenshots/
